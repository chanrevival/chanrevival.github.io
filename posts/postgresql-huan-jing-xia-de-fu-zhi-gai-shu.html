<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>谈谈PostgreSQL的数据复制 | Chan Revival Sky</title><meta name="author" content="Chan Revival"><meta name="copyright" content="Chan Revival"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言复制是任何数据库系统中至关重要的一部分，旨在提供高可用性（HA）和有效的灾难恢复（DR）策略。本文旨在阐明复制在数据库系统中的作用。文章将对复制及其类型进行总体概述，并介绍 PostgreSQL 中的复制选项。 “复制”一词用来描述在一个或多个软件或硬件系统之间共享信息的过程，以确保系统的可靠性、可用性和容错性。这些系统可以位于同一地点，可以在单台机器上，也可以通过广域网络相连。复制大致可以分">
<meta property="og:type" content="article">
<meta property="og:title" content="谈谈PostgreSQL的数据复制">
<meta property="og:url" content="https://blog.crsky.uk/posts/postgresql-huan-jing-xia-de-fu-zhi-gai-shu.html">
<meta property="og:site_name" content="Chan Revival Sky">
<meta property="og:description" content="前言复制是任何数据库系统中至关重要的一部分，旨在提供高可用性（HA）和有效的灾难恢复（DR）策略。本文旨在阐明复制在数据库系统中的作用。文章将对复制及其类型进行总体概述，并介绍 PostgreSQL 中的复制选项。 “复制”一词用来描述在一个或多个软件或硬件系统之间共享信息的过程，以确保系统的可靠性、可用性和容错性。这些系统可以位于同一地点，可以在单台机器上，也可以通过广域网络相连。复制大致可以分">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.crsky.uk/images/pg_db.jpg">
<meta property="article:published_time" content="2025-02-06T11:32:00.000Z">
<meta property="article:modified_time" content="2025-03-13T05:23:06.923Z">
<meta property="article:author" content="Chan Revival">
<meta property="article:tag" content="数据库·Databases">
<meta property="article:tag" content="PostgreSQL">
<meta property="article:tag" content="数据复制·Data replication">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.crsky.uk/images/pg_db.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "谈谈PostgreSQL的数据复制",
  "url": "https://blog.crsky.uk/posts/postgresql-huan-jing-xia-de-fu-zhi-gai-shu.html",
  "image": "https://blog.crsky.uk/images/pg_db.jpg",
  "datePublished": "2025-02-06T11:32:00.000Z",
  "dateModified": "2025-03-13T05:23:06.923Z",
  "author": [
    {
      "@type": "Person",
      "name": "Chan Revival",
      "url": "https://blog.crsky.uk/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.crsky.uk/posts/postgresql-huan-jing-xia-de-fu-zhi-gai-shu.html"><link rel="preconnect"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-1930969495144394',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-VN485BL2P4"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-VN485BL2P4')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-VN485BL2P4', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '谈谈PostgreSQL的数据复制',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/pluginsSrc/pace-js/themes/blue/pace-theme-minimal.css"/><script src="/pluginsSrc/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">141</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">211</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页·Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-universal-access"></i><span> 线路·Network</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ddns.crsky.uk:60000/"><i class="fa-fw fas fa-tachometer-alt"></i><span> 国内加速·CDN</span></a></li><li><a class="site-page child" href="https://blog.crsky.uk/"><i class="fa-fw fas fa-satellite-dish"></i><span> 国际线路·Global</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/news/"><i class="fa-fw fas fa-newspaper"></i><span> 新闻·News</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 技术·Tech</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/exoplanets/"><i class="fa-fw fas fa-globe"></i><span> 地外文明·Exoplanets</span></a></li><li><a class="site-page child" href="/software/"><i class="fa-fw fas fa-code"></i><span> 软件技术·Software</span></a></li><li><a class="site-page child" href="/database/"><i class="fa-fw fas fa-database"></i><span> 数据库技术·Databases</span></a></li><li><a class="site-page child" href="/linux_tools/"><i class="fa-fw fas fa-terminal"></i><span> Linux工具箱·Linux Tools</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 休闲·Leisure</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/literature/"><i class="fa-fw fas fa-newspaper"></i><span> 美文共赏·Literature</span></a></li><li><a class="site-page child" href="/photography2/"><i class="fa-fw fas fa-camera-retro"></i><span> 摄影艺术·Photography</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐潮流·Music</span></a></li><li><a class="site-page child" href="/cinema/"><i class="fa-fw fas fa-film"></i><span> 影视艺术·Cinema</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i><span> 关于·About</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/feedback/"><i class="fa-fw fas fa-comments"></i><span> 留言板·Feedback</span></a></li><li><a class="site-page child" href="/voice/"><i class="fa-fw fas fa-user"></i><span> 站主之声·Voice</span></a></li><li><a class="site-page child" href="/updates/"><i class="fa-fw fas fa-cogs"></i><span> 网站更新·Updates</span></a></li><li><a class="site-page child" href="/contact/"><i class="fa-fw fas fa-envelope"></i><span> 联系我们·Contact</span></a></li><li><a class="site-page child" href="/privacy/"><i class="fa-fw fas fa-list"></i><span> 隐私政策·Privacy</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Chan Revival Sky</span></a><a class="nav-page-title" href="/"><span class="site-name">谈谈PostgreSQL的数据复制</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页·Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-universal-access"></i><span> 线路·Network</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ddns.crsky.uk:60000/"><i class="fa-fw fas fa-tachometer-alt"></i><span> 国内加速·CDN</span></a></li><li><a class="site-page child" href="https://blog.crsky.uk/"><i class="fa-fw fas fa-satellite-dish"></i><span> 国际线路·Global</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/news/"><i class="fa-fw fas fa-newspaper"></i><span> 新闻·News</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 技术·Tech</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/exoplanets/"><i class="fa-fw fas fa-globe"></i><span> 地外文明·Exoplanets</span></a></li><li><a class="site-page child" href="/software/"><i class="fa-fw fas fa-code"></i><span> 软件技术·Software</span></a></li><li><a class="site-page child" href="/database/"><i class="fa-fw fas fa-database"></i><span> 数据库技术·Databases</span></a></li><li><a class="site-page child" href="/linux_tools/"><i class="fa-fw fas fa-terminal"></i><span> Linux工具箱·Linux Tools</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 休闲·Leisure</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/literature/"><i class="fa-fw fas fa-newspaper"></i><span> 美文共赏·Literature</span></a></li><li><a class="site-page child" href="/photography2/"><i class="fa-fw fas fa-camera-retro"></i><span> 摄影艺术·Photography</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐潮流·Music</span></a></li><li><a class="site-page child" href="/cinema/"><i class="fa-fw fas fa-film"></i><span> 影视艺术·Cinema</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i><span> 关于·About</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/feedback/"><i class="fa-fw fas fa-comments"></i><span> 留言板·Feedback</span></a></li><li><a class="site-page child" href="/voice/"><i class="fa-fw fas fa-user"></i><span> 站主之声·Voice</span></a></li><li><a class="site-page child" href="/updates/"><i class="fa-fw fas fa-cogs"></i><span> 网站更新·Updates</span></a></li><li><a class="site-page child" href="/contact/"><i class="fa-fw fas fa-envelope"></i><span> 联系我们·Contact</span></a></li><li><a class="site-page child" href="/privacy/"><i class="fa-fw fas fa-list"></i><span> 隐私政策·Privacy</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">谈谈PostgreSQL的数据复制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-06T11:32:00.000Z" title="发表于 2025-02-06 19:32:00">2025-02-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-13T05:23:06.923Z" title="更新于 2025-03-13 13:23:06">2025-03-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E6%8A%80%C2%B7Tech/">科技·Tech</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E6%8A%80%C2%B7Tech/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF%C2%B7Databases/">数据库技术·Databases</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E6%8A%80%C2%B7Tech/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF%C2%B7Databases/PostgreSQL/">PostgreSQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-03-13 13:23:06&quot;}" hidden></div><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>复制是任何数据库系统中至关重要的一部分，旨在提供高可用性（HA）和有效的灾难恢复（DR）策略。本文旨在阐明复制在数据库系统中的作用。文章将对复制及其类型进行总体概述，并介绍 PostgreSQL 中的复制选项。</p>
<p>“复制”一词用来描述在一个或多个软件或硬件系统之间共享信息的过程，以确保系统的可靠性、可用性和容错性。这些系统可以位于同一地点，可以在单台机器上，也可以通过广域网络相连。复制大致可以分为硬件和软件两大类。我们将简单探讨这两类，但本文的主要关注点是数据库复制。那么，首先让我们了解构成数据库复制系统的要素。</p>
<p>简而言之，数据库复制描述的是将数据从一个数据库实例复制到一个或多个数据库实例的过程。同样，这些实例可以位于同一位置，也可以通过广域网络相连。</p>
<h2 id="基于硬件的复制"><a href="#基于硬件的复制" class="headerlink" title="基于硬件的复制"></a>基于硬件的复制</h2><p>我们先从硬件复制开始。基于硬件的复制使多个连接的系统保持同步。这种数据同步在存储层面完成，一旦系统执行了 I&#x2F;O 操作，就会将操作传播到配置好的存储模块、设备或系统中。这种复制既可以针对整个存储设备进行，也可以仅针对选定的分区。此类解决方案的最大优势在于（通常）更易于部署，并且与软件无关，这使得其性能更优，但同时也降低了对复制过程的灵活性和控制。以下是该复制类型的一些优点：</p>
<ol>
<li>实时性 —— 所有更改都会立即应用到后续系统中。</li>
<li>易于设置 —— 无需编写脚本或进行软件配置。</li>
<li>独立于应用 —— 复制发生在存储层，与操作系统或应用程序无关。</li>
<li>数据完整性和一致性 —— 由于镜像操作在存储层进行，从而能够精确复制存储磁盘，因此能自动确保数据的完整性和一致性。</li>
</ol>
<p>尽管基于硬件的复制具有一些非常吸引人的优点，但它也存在自身的局限性。通常这类复制依赖于供应商锁定，即必须使用相同类型的硬件，而且往往成本较高。</p>
<h2 id="基于软件的复制"><a href="#基于软件的复制" class="headerlink" title="基于软件的复制"></a>基于软件的复制</h2><p>这种复制方式既包括通用解决方案，也包括针对特定产品的解决方案。通用解决方案通常在软件层面上模仿硬件复制，通过在不同系统间复制数据来实现复制。负责执行复制的软件会将写入源存储的每一位数据复制并传送到目标系统。而针对特定产品的解决方案则更侧重于满足产品的特定需求，通常专为某一产品量身定制。</p>
<p>基于软件的复制各有优缺点。一方面，它提供了复制过程的灵活性和控制能力，通常成本较低，同时具备更丰富的功能；但另一方面，它需要大量配置，并且需要持续的监控和维护。</p>
<h2 id="数据库复制"><a href="#数据库复制" class="headerlink" title="数据库复制"></a>数据库复制</h2><p>在讨论完复制及其不同类型后，让我们把注意力转向数据库复制这一主题。</p>
<p>在进一步详细说明之前，先来讨论一下在数据库领域中用于描述复制系统各组件的不同术语。常用的术语包括 Primary-Standby、Master-Slave、Publisher-Subscriber 以及 Master-Master&#x2F;Multimaster，它们都用于描述参与复制设置的数据库服务器。</p>
<p>术语 “Primary”、“Master” 和 “Publisher” 用来描述那些主动节点，这些节点负责将接收到的更改传播给其他节点；而 “Standby”、“Slave” 和 “Subscriber” 则用于描述那些被动节点，这些节点负责接收来自主动节点传播的更改。本文中，我们将使用 “Primary” 表示主动节点，使用 “Standby” 表示被动节点。</p>
<p>数据库复制可以配置为 Primary-Standby 配置和 Multi-master 配置。</p>
<p>在 Primary-Standby 配置中，只有一个实例接收数据更改，然后将这些更改分发给各个 Standby 节点。</p>
<p>而在多主系统中，每个数据库实例都可以接收数据更改，并将这些更改传播给其他实例。</p>
<h2 id="同步-异步复制"><a href="#同步-异步复制" class="headerlink" title="同步&#x2F;异步复制"></a>同步&#x2F;异步复制</h2><p>复制过程的核心在于 Primary 节点将数据传输给 Standby 节点的能力。与其他数据传输策略类似，这一过程可以以同步方式进行，即 Primary 节点在等待所有 Standby 节点确认已接收并写入数据到磁盘后，再向客户端发送确认。或者，Primary 节点可以先在本地提交数据，然后在适当时机将事务数据传输给 Standby 节点，并期望 Standby 节点能够接收并写入数据到磁盘。在这种情况下，Standby 节点不会向 Primary 节点发送确认。前一种策略称为同步复制，而后一种则称为异步复制。无论是基于硬件还是基于软件的解决方案，都支持同步和异步复制。</p>
<p>由于这两种策略的主要区别在于是否等待被动节点确认数据写入，因此各有优缺点。同步复制可以配置为所有系统都保持最新状态，实现实时复制；但与此同时，由于主节点需要等待被动节点的确认，这会对系统性能产生不利影响。</p>
<p>相比之下，异步复制通常能提供更好的性能，因为它不需要等待来自被动节点的确认消息。</p>
<h2 id="级联复制"><a href="#级联复制" class="headerlink" title="级联复制"></a>级联复制</h2><p>到目前为止，我们看到只有 Primary 节点将事务数据传输给 Standby 节点。但这个负载可以分摊到多个系统上；也就是说，一个已接收数据并写入磁盘的 Standby 节点可以将数据继续传输给配置为从它接收数据的其他 Standby 节点。这种方式称为级联复制，即在 Primary 与 Standby 之间，以及 Standby 与 Standby 之间配置复制。下图直观地展示了级联复制的过程。</p>
<h2 id="备用模式"><a href="#备用模式" class="headerlink" title="备用模式"></a>备用模式</h2><ul>
<li>Warm standby 用于描述一种备用服务器，这种服务器允许接收来自主节点的更改，但不允许客户端直接连接。</li>
<li>Hot standby 用于描述一种备用服务器，它不仅允许接收来自主节点的更改，还允许接受客户端连接。</li>
</ul>
<h2 id="PostgreSQL-复制"><a href="#PostgreSQL-复制" class="headerlink" title="PostgreSQL 复制"></a>PostgreSQL 复制</h2><p>最后，我想介绍一下 PostgreSQL 提供的复制选项。</p>
<p>PostgreSQL 提供内置的日志流复制和逻辑复制选项。其中，内置复制仅适用于主备（Primary-Standby）配置。</p>
<h2 id="流复制（SR）"><a href="#流复制（SR）" class="headerlink" title="流复制（SR）"></a>流复制（SR）</h2><p>在 PostgreSQL 中，流复制也被称为物理复制或二进制复制。二进制数据被传输至备用服务器。为了实现这一点，流复制使用了 WAL（预写日志）记录。任何在主服务器上进行的更改都会先写入 WAL 文件，然后再写入磁盘，数据库服务器具备将这些日志记录传输到任意数量备用服务器的能力。由于这种复制方式是数据的二进制拷贝，因此也存在一些限制。此类型的复制仅适用于需要在备用服务器上复制所有更改的情况，如果只需要复制部分更改，则无法使用。此外，备用服务器要么不接受连接，要么只能处理只读查询。另一个限制是，该复制方式不能与不同版本的数据库服务器混用，整个系统中所有数据库服务器的版本必须一致。</p>
<p>默认情况下，流复制是异步的，不过开启同步复制也并不困难。这种配置非常适合实现高可用性（HA）。如果主服务器发生故障，由于备用服务器几乎是其完全相同的拷贝，其中一台即可接替主服务器的工作。以下是基本配置示例：</p>
<ol>
<li>首先，在主数据库中创建一个具有复制权限的用户，该用户将用于备用服务器与主服务器建立连接：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> foouser REPLICATION;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将该用户添加到 pg_hba.conf 文件中，以允许其进行身份验证：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TYPE  DATABASE        USER       ADDRESS                 METHOD</span></span><br><span class="line">host    replication     foouser    &lt;ip address range&gt;      trust</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在备用服务器上执行基准备份：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_basebackup -h &lt;primary-ip&gt; -U foouser -D ~/standby</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 postgresql.conf 文件中，需要添加以下配置项：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wal_level=replica <span class="comment"># 对于流复制，应将其设置为 replica</span></span><br><span class="line">max_wal_senders = 8 <span class="comment"># 允许同时连接的备用服务器数量</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在备用服务器上，在其数据目录下创建 recovery.conf 文件，并添加以下内容：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">standby_mode=on</span><br><span class="line">primary_conninfo=<span class="string">&#x27;user=foouser host=&lt;primary-ip&gt; port=&lt;primary-port&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>现在启动服务器，基本的流复制即可生效。</p>
<h2 id="逻辑复制"><a href="#逻辑复制" class="headerlink" title="逻辑复制"></a>逻辑复制</h2><p>与流复制相比，逻辑复制在 PostgreSQL 中相对较新。流复制是对整个数据的逐字节复制，但它不支持将单个表或部分数据从主服务器复制到备用服务器。逻辑复制则允许只复制数据库中指定的对象到备用服务器，而不是复制整个数据库。它还支持在不同版本的数据库服务器之间进行数据复制，并且允许备用服务器既接受读请求，也接受写请求。</p>
<p>然而，需要注意的是，逻辑复制尚未实现冲突解决机制。因此，如果主服务器和备用服务器都被允许对同一张表进行写操作，很可能会出现数据冲突，从而中断复制过程。在这种情况下，用户必须手动解决冲突。不过，如果主服务器和备用服务器分别只对完全不重叠的数据集进行写操作，就可以避免冲突解决的问题。</p>
<p>以下是基本配置示例：</p>
<ol>
<li>首先，在主数据库中创建一个具有复制权限的用户，该用户将用于备用服务器与主服务器建立连接：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> foouser REPLICATION;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将该用户添加到 pg_hba.conf 文件中，以允许其进行身份验证：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TYPE  DATABASE        USER       ADDRESS                 METHOD</span></span><br><span class="line">host    replication     foouser    &lt;ip address range&gt;      trust</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>对于逻辑复制，基准备份不是必需的，任何一个数据库实例都可以用来创建该设置。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wal_level=logical <span class="comment"># 对于逻辑复制，wal_level 需要在 postgresql.conf 文件中设置为 logical。</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在主服务器上，创建一些用于复制的表，并创建一个发布，列出这些表。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> t1 (col1 <span class="type">int</span>, col2 <span class="type">varchar</span>);</span><br><span class="line"><span class="keyword">CREATE TABLE</span> t2 (col1 <span class="type">int</span>, col2 <span class="type">varchar</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> t1 ....;</span><br><span class="line"><span class="keyword">INSERT INTO</span> t2 ....;</span><br><span class="line"><span class="keyword">CREATE</span> PUBLICATION foopub <span class="keyword">FOR</span> <span class="keyword">TABLE</span> t1, t2;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在备用服务器上，需要创建上述提到的表的结构，因为 DDL 不会被复制。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> t1 (col1 <span class="type">int</span>, col2 <span class="type">varchar</span>);</span><br><span class="line"><span class="keyword">CREATE TABLE</span> t2 (col1 <span class="type">int</span>, col2 <span class="type">varchar</span>);</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在备用服务器上，为上述发布创建一个订阅。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SUBSCRIPTION foosub CONNECTION <span class="string">&#x27;host=&lt;primary-ip&gt; port=&lt;primary-port&gt; user=foouser&#x27;</span> PUBLICATION foopub;</span><br></pre></td></tr></table></figure>

<p>现在启动服务器，基本的流复制应即可生效。</p>
<p>希望这篇博客能帮助您了解复制的一般概念，以及从 PostgreSQL 的角度理解流复制和逻辑复制的原理。此外，也希望这能助您更好地设计出满足您需求的复制环境。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.crsky.uk">Chan Revival</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.crsky.uk/posts/postgresql-huan-jing-xia-de-fu-zhi-gai-shu.html">https://blog.crsky.uk/posts/postgresql-huan-jing-xia-de-fu-zhi-gai-shu.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.crsky.uk" target="_blank">Chan Revival Sky</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%C2%B7Databases/">数据库·Databases</a><a class="post-meta__tags" href="/tags/PostgreSQL/">PostgreSQL</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6%C2%B7Data-replication/">数据复制·Data replication</a></div><div class="post-share"><div class="social-share" data-image="/images/pg_db.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/postgresql-pei-zhi-wen-jian-zhong-postgresql.conf-yu-postgresql.auto.conf-de-yi-tong-dian.html" title="PostgreSQL配置文件中postgresql.conf与postgresql.auto.conf的异同点"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/pg_db.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-13</div><div class="info-item-2">PostgreSQL配置文件中postgresql.conf与postgresql.auto.conf的异同点</div></div><div class="info-2"><div class="info-item-1">在PostgreSQL数据库的日常运维中，配置管理始终是DBA工作的核心环节。随着PostgreSQL 12版本的发布，其配置管理系统在保持传统优势的基础上，进一步强化了动态配置能力。本文将深入剖析postgresql.conf与postgresql.auto.conf两个关键配置文件的技术内涵，通过架构设计、运行机制、实践应用等多维度的对比分析，揭示二者在现代数据库运维体系中的协同关系。 一、配置体系的演进脉络PostgreSQL的配置管理经历了从单一文件到分层管理的演进过程。在早期版本中，所有配置参数都集中在postgresql.conf文件中，这种集中式管理虽然直观，但在动态调整和版本控制方面存在明显局限。自9.4版本引入ALTER SYSTEM命令后，配置体系逐步形成了双轨制管理模式。 在PostgreSQL 12中，这种分层架构达到新的成熟度：  基础配置文件（postgresql.conf）：作为声明式配置的载体 自动配置文件（postgresql.auto.conf）：记录动态调整的增量配置 内存运行时配置：通过pg_settings视图实时反映  这种三层架构不仅提升了配置的灵活性，更为自动化运维提供了基础设施支持。值得关注的是，postgresql.auto.conf在12版本中强化了原子写入特性，确保在高并发场景下的配置更新可靠性。 二、技术特性的多维度对比2.1 文件生成机制  postgresql.conf：手工创建&#x2F;编辑，存在于$PGDATA目录 postgresql.auto.conf：由ALTER SYSTEM命令自动生成和维护  案例演示： 12345678-- 执行动态配置修改ALTER SYSTEM SET shared_buffers = &#x27;4GB&#x27;;-- 查看生成的auto.conf\! cat...</div></div></div></a><a class="pagination-related" href="/posts/bu-guan-bi-zhu-ku-shi-yong-rman-fu-zhi-chuang-jian-wu-li-bei-ku.html" title="不关闭主库，使用RMAN复制创建物理备库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/20241118000.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-18</div><div class="info-item-2">不关闭主库，使用RMAN复制创建物理备库</div></div><div class="info-2"><div class="info-item-1">适用于Oracle数据库 - 企业版 - 版本10.1.0.2至10.2.0.4 [10.1至10.2]Oracle数据库 - 企业版 - 版本12.1.0.2至12.1.0.2 [12.1]Oracle数据库 - 企业版 - 版本11.2.0.4至11.2.0.4 [11.2]Oracle数据库 - 企业版 - 版本11.1.0.7至11.1.0.7 [11.1]  目标以下说明描述了如何在不关闭主（生产）数据库的情况下，使用RMAN复制逐步创建物理备用数据库的过程。Database Name :- primPrimary db_unique_name :- primstandby db_unique_name :- stdbyPrimary Hostname :- raca.idc.oracle.comstandby Hostname :- core1.idc.oracle.com  解决方案 启用强制日志记录。 创建备用重做日志（SRL）。 在主数据库的参数文件中做出适当的更改。 备份数据库，包括数据文件、归档日志和控制文件，以便备用，并将备份复制到备用服务器。 为备用数据库创建参数文件。 从主数据库到备用数据库建立连接。 将备份移动到备用服务器。  和 9. 启动备用实例。 使用RMAN复制命令创建备用数据库。 创建SRL。 启动MRP（管理恢复进程）。 验证是否正确地将日志发送并应用到备用数据库。  步骤1：在主数据库上启用强制日志记录。 1SQL&gt; ALTER DATABASE FORCE LOGGING; 注意：如果不存在，请创建密码文件，同时检查是否已启用归档。 步骤2：在主数据库上配置备用重做日志。 1234SQL&gt; ALTER DATABASE ADD STANDBY LOGFILE GROUP 3...</div></div></div></a><a class="pagination-related" href="/posts/ru-he-jiang-asm-shu-ju-ku-wen-jian-cong-yi-ge-ci-pan-zu-yi-dong-dao-ling-yi-ge-ci-pan-zu.html" title="手把手教你迁移Oracle ASM文件 跨磁盘组操作指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/oracle_db.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="info-item-2">手把手教你迁移Oracle ASM文件 跨磁盘组操作指南</div></div><div class="info-2"><div class="info-item-1">在管理Oracle数据库时，我们经常需要把ASM文件从一个磁盘组挪到另一个磁盘组。今天就给大家分享两种亲测有效的迁移方法，连系统表空间怎么操作都会讲到，建议先收藏再看！ 迁移前的准备工作首先记住两个重要知识点：  从Oracle 12c开始，官方推荐用SQL语句直接操作（文末会教） 传统方法主要依赖RMAN工具，毕竟ASM文件不能像普通文件那样直接操作  通用迁移步骤（6步搞定） 锁定目标文件登录数据库执行：  1SELECT FILE_NAME FROM DBA_DATA_FILES;  比如我们要移动这个文件：+ASMDSK2&#x2F;orcl&#x2F;datafile&#x2F;users.256.565313879  确认目标磁盘组在ASM实例中查看：  1SELECT GROUP_NUMBER, NAME FROM V$ASM_DISKGROUP;  假设我们要移到ASMDSK1这个组  让文件下线  1ALTER DATABASE DATAFILE &#x27;+ASMDSK2/.../users.256.565313879&#x27; OFFLINE;  两种迁移方法任选👉 方法一：DBMS_FILE_TRANSFER（适合小文件）  创建目录对象  123-- 在源和目标磁盘组创建目录CREATE OR REPLACE DIRECTORY orcl1 AS &#x27;+asmdsk1/orcl/datafile&#x27;;CREATE OR REPLACE DIRECTORY orcl2 AS &#x27;+asmdsk2/test&#x27;;   执行文件拷贝  1234567BEGIN  DBMS_FILE_TRANSFER.COPY_FILE(    source_directory_object =&gt;...</div></div></div></a><a class="pagination-related" href="/posts/a-step-by-step-guide-to-mastering-mongodb-installation-and-configuration.html" title="手把手教你玩转MongoDB安装配置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/mongodb.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-04-03</div><div class="info-item-2">手把手教你玩转MongoDB安装配置</div></div><div class="info-2"><div class="info-item-1">初识NoSQL新秀说到数据库，除了咱们熟悉的关系型数据库，还有一位当红小生——NoSQL（可不是”不SQL”哦，人家全名是Not Only SQL）。今天要介绍的MongoDB就是这个家族的明星成员，作为基于分布式文件存储的文档型数据库，特别适合处理灵活的数据结构。下面就以RedHat 6.5系统为舞台，带大家体验源码安装MongoDB 3.6的全过程！ 准备工作不能少环境清单✅ 操作系统：RedHat Enterprise Linux 6.5 x64✅ 数据库版本：MongoDB 3.6.3 x64 系统配置二板斧 关闭防火墙新手建议先关防火墙，避免各种连接问题：  123service iptables stop# 看到这些OK提示就稳了iptables: Setting chains to policy ACCEPT: filter [  OK  ]   关闭SELINUX临时关闭更方便后续操作：  1setenforce 0  安装实战全记录下载解压一条龙12345# 官方源下载安装包curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.6.3.tgz# 解压到指定目录tar -xzvf mongodb-linux-x86_64-rhel62-3.6.3.tgz -C /opt/  环境变量配置秘籍编辑~&#x2F;.bash_profile文件，添加这行让命令随处可用： 1export PATH=/opt/mongodb-linux-x86_64-rhel62-3.6.3/bin:$PATH  专属用户不能少1useradd -M -s /sbin/nologin mongodb  # 创建无登录权限的系统用户  启动数据库有讲究数据存储要到位12mkdir -p...</div></div></div></a><a class="pagination-related" href="/posts/shou-ba-shou-jiao-ni-wan-zhuan-mongodb-an-zhuang-pei-zhi.html" title="A Step-by-Step Guide to Mastering MongoDB Installation and Configuration"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/mongodb.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-04-03</div><div class="info-item-2">A Step-by-Step Guide to Mastering MongoDB Installation and Configuration</div></div><div class="info-2"><div class="info-item-1">Getting to Know the New Star in NoSQLWhen it comes to databases, besides the well-known relational databases, there is a rising star in the scene—NoSQL (which is short for Not Only SQL). Today, we’ll introduce MongoDB, a key member of this family. As a document-oriented database based on distributed file storage, MongoDB is especially suitable for handling flexible data structures. In this guide, we will walk you through the process of installing MongoDB 3.6 from source on RedHat 6.5. Preparation Is KeySystem Requirements✅ Operating System: RedHat Enterprise Linux 6.5 x64✅ Database Version: MongoDB 3.6.3 x64 System Configuration Checklist Turn off the firewallFor beginners, it’s recommended to disable the firewall to avoid connection issues:  123service iptables stop# If you see...</div></div></div></a><a class="pagination-related" href="/posts/oracle-log-mining-case-study.html" title="Oracle Log Mining Case Study"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/oracle_db.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2013-11-10</div><div class="info-item-2">Oracle Log Mining Case Study</div></div><div class="info-2"><div class="info-item-1">OverviewThis document is a reading note from the official Oracle documentation Oracle Database Utilities 11g Release 2 (11.2) E22490-05, and it mainly introduces several examples of log mining using logmnr. Environment InformationOperating System VersionMicrosoft Windows Version 6.1.7601 Database VersionOracle 11g Release 11.2.0.1.0 Preparation WorkCreate a test table. All subsequent experiments are based on this test table.     Copy some data from the emp table of the scott user.  123SQL&gt; create table scott.tab_emp as select ename,sal from scott.emp;Table created.      View the data in the test table.  123456789101112131415161718SQL&gt; select * from scott.tab_emp;ENAME             SAL---------- ----------SMITH             800ALLEN            1600WARD             1250JONES         ...</div></div></div></a><a class="pagination-related" href="/posts/oracle-ri-zhi-wa-jue-an-li.html" title="Oracle日志挖掘案例"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/oracle_db.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2013-11-10</div><div class="info-item-2">Oracle日志挖掘案例</div></div><div class="info-2"><div class="info-item-1">概述本文档是笔者阅读Oracle官方文档Oracle Database Utilities 11g Release 2 (11.2) E22490-05的读书笔记，主要介绍了logmnr数据挖掘的若干个实例。 环境信息操作系统版本Microsoft Windows Version 6.1.7601 数据库版本Oracle 11g Release 11.2.0.1.0 准备工作构建一张测试表，后续的实验均基于这张测试表。     复制scott用户emp中的部分数据  123SQL&gt; create table scott.tab_emp as select ename,sal from scott.emp;表已创建。      查看测试表的数据  123456789101112131415161718SQL&gt; select * from scott.tab_emp;ENAME             SAL---------- ----------SMITH             800ALLEN            1600WARD             1250JONES            2975MARTIN           1250BLAKE            2850CLARK            2450SCOTT            3000KING             5000TURNER           1500ADAMS            1100JAMES             950FORD             3000MILLER           130014 rows selected.  日志挖掘实例查看最后归档的重做日志文件的更改   ...</div></div></div></a><a class="pagination-related" href="/posts/tan-tan-sheng-chan-huan-jing-zhong-postgresql-can-shu-de-yi-yi.html" title="谈谈生产环境中PostgreSQL参数的意义"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/pg_db.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-26</div><div class="info-item-2">谈谈生产环境中PostgreSQL参数的意义</div></div><div class="info-2"><div class="info-item-1">谈谈生产环境中PostgreSQL参数的意义archive_commandarchive_command &#x3D; ‘$pg_data_dir&#x2F;..&#x2F;arch.sh %f %p’ auto_explain.log_analyzeauto_explain.log_analyze &#x3D; true auto_explain.log_min_duration &#x3D; ‘300ms’ auto_explain.log_min_duration &#x3D; ‘300mss’ auto_explain.log_timing &#x3D; on auto_explain.log_verbose &#x3D; off autovacuum &#x3D; on autovacuum_analyze_scale_factor &#x3D; 0.01 autovacuum_freeze_max_age &#x3D; 1200000000 autovacuum_max_workers &#x3D; 12 autovacuum_multixact_freeze_max_age &#x3D; 1250000000autovacuum_vacuum_cost_delay &#x3D; 0msautovacuum_vacuum_scale_factor &#x3D; 0.02checkpoint_completion_target &#x3D; 0.5checkpoint_flush_after &#x3D; 0checkpoint_timeout &#x3D; 30mincheckpoint_timeout &#x3D; 30mindefault_text_search_config &#x3D;...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Chan Revival</div><div class="author-info-description">Chan Revival Sky</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">141</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">211</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/chanrevival"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/chanrevival" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:chanrevival@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">若网页打开缓慢，请切换线路（页面顶部）。<BR>If the webpage loads slowly, please switch lines (the option is at the top of the page).</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%A1%AC%E4%BB%B6%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">基于硬件的复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">基于软件的复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">数据库复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5-%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">同步&#x2F;异步复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E5%A4%8D%E5%88%B6"><span class="toc-number">6.</span> <span class="toc-text">级联复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">备用模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PostgreSQL-%E5%A4%8D%E5%88%B6"><span class="toc-number">8.</span> <span class="toc-text">PostgreSQL 复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%A4%8D%E5%88%B6%EF%BC%88SR%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">流复制（SR）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%A4%8D%E5%88%B6"><span class="toc-number">10.</span> <span class="toc-text">逻辑复制</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/20250314-na-zha-2-piao-fang-qi-ji-bei-hou-de-si-kao.html" title="《哪吒2》票房奇迹背后的思考"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/20250314_neza2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="《哪吒2》票房奇迹背后的思考"/></a><div class="content"><a class="title" href="/posts/20250314-na-zha-2-piao-fang-qi-ji-bei-hou-de-si-kao.html" title="《哪吒2》票房奇迹背后的思考">《哪吒2》票房奇迹背后的思考</a><time datetime="2025-03-14T14:35:00.000Z" title="发表于 2025-03-14 22:35:00">2025-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-2.huan-jing-da-jian-yu-hexo-an-zhuang-cong-ling-kai-shi-de-zhun-bei-gong-zuo.html" title="第二章：环境搭建与 Hexo 安装——从零开始的准备工作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/hexo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第二章：环境搭建与 Hexo 安装——从零开始的准备工作"/></a><div class="content"><a class="title" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-2.huan-jing-da-jian-yu-hexo-an-zhuang-cong-ling-kai-shi-de-zhun-bei-gong-zuo.html" title="第二章：环境搭建与 Hexo 安装——从零开始的准备工作">第二章：环境搭建与 Hexo 安装——从零开始的准备工作</a><time datetime="2025-03-14T06:20:01.000Z" title="发表于 2025-03-14 14:20:01">2025-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-1.chu-shi-hexo-kai-qi-bo-ke-xin-shi-dai.html" title="第一章：初识Hexo——开启博客新时代"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/hexo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第一章：初识Hexo——开启博客新时代"/></a><div class="content"><a class="title" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-1.chu-shi-hexo-kai-qi-bo-ke-xin-shi-dai.html" title="第一章：初识Hexo——开启博客新时代">第一章：初识Hexo——开启博客新时代</a><time datetime="2025-03-14T06:20:01.000Z" title="发表于 2025-03-14 14:20:01">2025-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-4.zhu-ti-xuan-ze-yu-ding-zhi-rang-ni-de-bo-ke-ge-xing-shi-zu.html" title="第四章：主题选择与定制——让你的博客个性十足"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/hexo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第四章：主题选择与定制——让你的博客个性十足"/></a><div class="content"><a class="title" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-4.zhu-ti-xuan-ze-yu-ding-zhi-rang-ni-de-bo-ke-ge-xing-shi-zu.html" title="第四章：主题选择与定制——让你的博客个性十足">第四章：主题选择与定制——让你的博客个性十足</a><time datetime="2025-03-14T06:20:01.000Z" title="发表于 2025-03-14 14:20:01">2025-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-3.chuang-jian-ni-de-di-yi-ge-hexo-bo-ke-xiang-mu-dong-shou-shi-jian-pian.html" title="第三章：创建你的第一个 Hexo 博客项目——动手实践篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/hexo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第三章：创建你的第一个 Hexo 博客项目——动手实践篇"/></a><div class="content"><a class="title" href="/posts/hexo-jian-she-ge-ren-wang-zhan-xi-lie-jiao-cheng-3.chuang-jian-ni-de-di-yi-ge-hexo-bo-ke-xiang-mu-dong-shou-shi-jian-pian.html" title="第三章：创建你的第一个 Hexo 博客项目——动手实践篇">第三章：创建你的第一个 Hexo 博客项目——动手实践篇</a><time datetime="2025-03-14T06:20:01.000Z" title="发表于 2025-03-14 14:20:01">2025-03-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Chan Revival</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'u4i90Gtr4z5ltiEyAwZXwAaG-gzGzoHsz',
      appKey: '5QCoDhscDztlH49YntlyPmVV',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('/pluginsSrc/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>